/**
 * UI Initiative Stories Slider 1.0.0
 *
 * Instagram-like Stories Slider Made With Swiper
 *
 * https://uiinitiative.com
 *
 * Copyright 2022-2024 UI Initiative
 *
 * Released under the UI Initiative Regular License
 *
 * Released on: March 19, 2024
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).createStoriesSlider=t()}(this,(function(){"use strict";return function(e,t={}){const i=e.querySelector(".swiper"),{autoplayDuration:s=5e3,Swiper:r,EffectCube:n,onSlidesIndexesChange:o,onAutoplayStart:a,onAutoplayStop:l,onEnd:d}=t;let c,u,{enabled:p=!0}=t,m=0;const f=[];let v,h,y,b,S,E,g,A,q;const w=(e,t)=>{const i=f.indexOf(e);let r=void 0===t?s:t,n=parseInt(e.slides[e.activeIndex].getAttribute("data-duration"),10);const o=e.slides[e.activeIndex].querySelector("video");return Number.isNaN(n)&&o&&(n=1e3*o.duration),!Number.isNaN(n)&&n>0&&void 0===t&&(r=n),g=r,e.storiesSliderAutoplayTimeout=setTimeout((()=>{if(e.isEnd){if(m!==i)return;c.isEnd?d&&d():c.slideNext()}else e.slideNext()}),r),a&&a(e),r},T=e=>{clearTimeout(e.storiesSliderAutoplayTimeout),l&&l(e)},x=e=>{T(e);const t=e.slides[e.activeIndex].querySelector("video");t&&(cancelAnimationFrame(u),t.pause());const i=g||s;let r=parseInt(e.slides[e.activeIndex].getAttribute("data-duration"),10);if(Number.isNaN(r)&&(r=void 0),!r&&t&&(r=1e3*t.duration),g=i-((new Date).getTime()-E),e.isEnd&&g<0)return;g<0&&(g=0);const n=1-g/(r||s),o=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`);o.querySelector("span").remove(),o.insertAdjacentHTML("beforeend",`<span style="transform:translateX(${100*n-100}%)"></span>`)},L=e=>{if(e.isEnd&&g<0)return;E=(new Date).getTime(),w(e,g);const t=e.slides[e.activeIndex].querySelector("video");if(t)try{u=requestAnimationFrame((()=>{t.play()}))}catch(e){}const i=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1}) > span`);i.style.transform="translateX(0%)",i.style.transitionDuration=`${g}ms`},I=e=>{T(e),w(e),E=(new Date).getTime();const t=e.el.querySelector(".stories-slider-pagination-bullet-current");t&&t.classList.remove("stories-slider-pagination-bullet-current");const i=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`),s=e.slides[e.activeIndex].querySelector("video");if(s){s.currentTime=0;try{u=requestAnimationFrame((()=>{s.play()}))}catch(e){}}e.slides.forEach((e=>{e.querySelectorAll("video").forEach((e=>{e!==s&&(e.currentTime=0,s||cancelAnimationFrame(u),e.pause())}))})),f.filter(((e,t)=>t!==m)).forEach((e=>{e.el.querySelectorAll("video").forEach((e=>{s||cancelAnimationFrame(u),e.pause()}))}));const r=[...i.parentElement.children],n=[...r].filter(((e,t)=>t<r.indexOf(i))),a=[...r].filter(((e,t)=>t>r.indexOf(i)));n.forEach((e=>{e.classList.add("stories-slider-pagination-bullet-viewed"),e.querySelectorAll("span").forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend","<span></span>")})),a.forEach((e=>{e.classList.remove("stories-slider-pagination-bullet-viewed","stories-slider-pagination-bullet-current"),e.querySelectorAll("span").forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend","<span></span>")})),i.classList.remove("stories-slider-pagination-bullet-viewed"),i.classList.add("stories-slider-pagination-bullet-current"),[...i.children].forEach((e=>e.remove())),i.insertAdjacentHTML("beforeend","<span></span>"),i.clientWidth,i.querySelector("span").style.transform="translateX(0%)",i.querySelector("span").style.transitionDuration=`${g}ms`,o&&(cancelAnimationFrame(v),v=requestAnimationFrame((()=>{o(m,e.activeIndex)})))};return(()=>{const t=()=>{e.classList.add("stories-slider-perspective")},s=()=>{e.classList.remove("stories-slider-perspective")};c=new window.Swiper(i,{modules:void 0!==n?[n]:[],effect:"cube",speed:500,threshold:5,cubeEffect:{shadow:!1},observer:!0,on:{transitionStart(){s()},sliderFirstMove(){s()},transitionEnd(){t()},init(e){e.params.resistanceRatio=.5,t()},slideChange(){q=!1;const e=f[m];m=c.activeIndex;const t=f[m];T(e),w(t),I(t)}}})})(),e.querySelectorAll(".swiper .swiper").forEach(((e,t)=>{const i=new window.Swiper(e,{speed:1,nested:!0,allowTouchMove:!1,observer:!0,on:{touchStart(e){q||(h=!0,A=!1,y=(new Date).getTime(),b=setTimeout((()=>{A=!0,x(e)}),200))},touchEnd(e){q||(clearTimeout(b),m===t&&h&&(S=(new Date).getTime()-y,A&&L(e),A=!1,h=!1))},init(e){p&&(m!==t?T(e):requestAnimationFrame((()=>{I(e)})))},slideChange(e){q=!1,I(e)}}});(e=>{const t=e.querySelectorAll(".swiper-slide"),i=document.createElement("div");i.classList.add("stories-slider-pagination");for(let e=0;e<t.length;e+=1){const e=document.createElement("div");e.classList.add("stories-slider-pagination-bullet"),e.appendChild(document.createElement("span")),i.appendChild(e)}e.appendChild(i)})(e),((e,t)=>{e.querySelectorAll(".swiper-slide").forEach((e=>{const i=document.createElement("div"),s=document.createElement("div");i.classList.add("stories-slider-button","stories-slider-button-prev"),s.classList.add("stories-slider-button","stories-slider-button-next"),e.appendChild(i),e.appendChild(s),i.addEventListener("click",(()=>{S>200||(t.isBeginning?c.slidePrev():t.slidePrev())})),s.addEventListener("click",(()=>{S>200||(t.isEnd?c.slideNext():t.slideNext())}))}))})(e,i),f.push(i)})),{el:e,mainSwiper:c,subSwipers:f,destroy:()=>{c&&c.destroy&&c.destroy(),f.forEach((e=>{T(e),e.el.querySelectorAll(".stories-slider-pagination, .stories-slider-pagination-bullet").forEach((e=>e.remove())),(e=>{e.el.querySelectorAll(".stories-slider-button").forEach((e=>e.remove()))})(e),e.destroy&&e.destroy()}))},slideTo:(e,t)=>{if(c&&c.slideTo&&!c.destroyed&&c.slideTo(e,0),void 0!==t){const i=f[e];i.slideTo&&!i.destroyed&&(i.activeIndex===t?I(i):i.slideTo(t,0))}},enable:()=>{p||f.forEach(((e,t)=>{t===m&&I(e)}))},disable:()=>{p=!1,f.forEach(((e,t)=>{e.el.querySelectorAll("video").forEach((e=>{cancelAnimationFrame(u),e.pause()})),t===m?x(e):T(e)}))},pause:(e=!1)=>{q=!!e,x(f[m])},resume:()=>{q=!1,L(f[m])}}}}));
//# sourceMappingURL=stories-slider.min.js.map